#!/bin/sh

echo "ğŸ“ Validating commit message..."

# ValidaÃ§Ã£o com commitlint
npx --no-install commitlint --edit "$1"

if [ $? -ne 0 ]; then
  echo "âŒ Commit message validation failed!"
  echo ""
  echo "ğŸ“‹ Expected format: type(scope): subject"
  echo "ğŸ“‹ Example: feat(auth): add user authentication"
  echo "ğŸ“‹ Types: feat, fix, docs, style, refactor, test, chore, perf, ci, build, revert"
  exit 1
fi

# Checagem de assinaturas de IA proibidas (mesma validaÃ§Ã£o do CI)
if grep -qE "(ğŸ¤–|Generated with.*Claude|Co-Authored-By:.*Claude|Co-Authored-By:.*AI|Assisted by.*AI|With the help of Claude)" "$1"; then
  echo ""
  echo "âŒâŒâŒ COMMIT BLOQUEADO âŒâŒâŒ"
  echo ""
  echo "ğŸš« Assinaturas de IA nÃ£o sÃ£o permitidas neste projeto!"
  echo ""
  echo "PadrÃµes bloqueados detectados:"
  echo "  â€¢ Emoji de robÃ´ (ğŸ¤–)"
  echo "  â€¢ 'Generated with Claude/AI'"
  echo "  â€¢ 'Co-Authored-By: Claude'"
  echo "  â€¢ 'Co-Authored-By: AI'"
  echo "  â€¢ 'Assisted by AI'"
  echo "  â€¢ 'With the help of Claude'"
  echo ""
  echo "ğŸ’¡ Remova TODAS as referÃªncias a IA antes de commitar."
  echo ""
  exit 1
fi

echo "âœ… Commit message is valid!"
